---
export const prerender = true;

import {
  getSiteSettings,
  getPageData,
  getTagsWithPostCounts,
  shouldIndexPage,
} from "../../core/blogLogic";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Breadcrumb from "../../components/navigation/Breadcrumb.astro";
import SimpleBannerAd from "../../components/ads/SimpleBannerAd.astro";
import { generateBreadcrumbs } from "../../core/navigation/breadcrumbUtils";

const settings = await getSiteSettings();
const pageData = await getPageData("all-tags");
const breadcrumbs = generateBreadcrumbs("/tags");
const tags = await getTagsWithPostCounts();

// Check if this page should be indexed
const shouldIndex = await shouldIndexPage("tags");

// Enhanced SEO data
const seoData = {
  pageTitle: pageData?.seo?.title || "Coffee Tags & Topics | AstroPress Coffee",
  description: pageData?.seo?.description || "Discover all coffee tags and topics on AstroPress Coffee.",
  keywords: pageData?.seo?.keywords || ["coffee tags", "coffee topics", "brewing techniques"],
  ogImage: pageData?.seo?.ogImage || "/images/seo/coffee-tags-main-og.jpg",
  ogImageAlt: "Coffee tags and topics overview",
  canonicalUrl: `${settings.siteUrl}/tags`
};
---

<BaseLayout 
  pageTitle={seoData.pageTitle} 
  description={seoData.description}
  keywords={seoData.keywords}
  ogImage={seoData.ogImage}
  ogImageAlt={seoData.ogImageAlt}
  canonicalUrl={seoData.canonicalUrl}
  noindex={!shouldIndex}
>
  {settings.imageDomain && (
    <link rel="preconnect" href={settings.imageDomain} slot="head" />
  )}

  <!-- Hero Section -->
  <section class="theme-hero-section py-8 lg:py-12">
    <div class="container max-w-7xl">
      <Breadcrumb items={breadcrumbs} />
      
      <div class="theme-page-header">
        <h1 class="theme-page-title">
          Explore Tags
        </h1>

        <p class="theme-page-description">
          {
            pageData?.description ||
              "Discover articles organized by topics and themes. Find your perfect content tag to explore our curated collection of insights and stories."
          }
        </p>
      </div>
    </div>
  </section>

  <!-- Main Content Section with Grid Layout -->
  <section class="py-8 lg:py-12" style="background: var(--bg-primary)">
    <div class="container max-w-7xl">
      <div class="theme-grid-layout">
        
        <!-- Main Content Area -->
        <main>
          <!-- Tags Grid -->
          <div class="theme-categories-grid">
            {
              tags.map((tag) => (
                <a href={`/tags/${tag.data.slug}`} class="group">
                  <article class="theme-category-card">
                    <div class="p-6 lg:p-8">
                      <div class="flex items-start gap-4 mb-6">
                        <div class="theme-category-icon">
                          <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path
                              fill-rule="evenodd"
                              d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z"
                              clip-rule="evenodd"
                            />
                          </svg>
                        </div>

                        <div class="flex-1">
                          <h3 class="text-xl lg:text-2xl font-bold mb-2 theme-text-primary">
                            #{tag.data.name}
                          </h3>
                          <div class="theme-category-count">
                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                              <path
                                fill-rule="evenodd"
                                d="M2 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 002 2H4a2 2 0 01-2-2V5zm3 1h6v4H5V6zm6 6H5v2h6v-2z"
                                clip-rule="evenodd"
                              />
                            </svg>
                            <span>
                              {tag.postCount} {tag.postCount === 1 ? "article" : "articles"}
                            </span>
                          </div>
                        </div>
                      </div>

                      <p class="leading-relaxed mb-6 theme-text-secondary">
                        {tag.data.description || `Explore articles tagged with ${tag.data.name}`}
                      </p>

                      <div class="theme-action-link">
                        <span>Explore Articles</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17 8l4 4m0 0l-4 4m4-4H3"
                          />
                        </svg>
                      </div>
                    </div>
                  </article>
                </a>
              ))
            }
          </div>

          <!-- Back to Blog Link -->
          <div class="mt-12 text-center">
            <a href="/blog" class="theme-action-button">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                />
              </svg>
              <span>Back to All Articles</span>
            </a>
          </div>
        </main>

        <!-- Sidebar -->
        <aside class="theme-sidebar">
          
          <!-- Ad Placement -->
          <SimpleBannerAd placement="tags-sidebar" className="sidebar" />
          

        </aside>
      </div>
    </div>
  </section>
</BaseLayout>