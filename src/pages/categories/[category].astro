---
export const prerender = true;

import { 
  generateCategoryPaths, 
  generateCategorySEO, 
  getSiteSettings 
} from '../../core/blogLogic';
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogList from '../../components/blog/BlogList.astro';
import Breadcrumb from '../../components/navigation/Breadcrumb.astro';
import { getCategoryBreadcrumbs } from '../../core/navigation/breadcrumbUtils';

export const getStaticPaths = generateCategoryPaths;

const { posts } = Astro.props;
const { category: categorySlug } = Astro.params;

// Handle undefined categorySlug
if (!categorySlug) {
  throw new Error('Category slug is required');
}

const settings = await getSiteSettings();
const seoData = await generateCategorySEO(categorySlug);

const allCategories = await getCollection('categories');
const categoryData = allCategories.find(cat => cat.data.slug === categorySlug);
const categoryName = categoryData ? categoryData.data.name : categorySlug;
const categoryDescription = categoryData ? categoryData.data.description : null;

const breadcrumbs = getCategoryBreadcrumbs(categorySlug, categoryData);
---

<BaseLayout 
  pageTitle={seoData.pageTitle} 
  description={seoData.description}
  ogImage={seoData.ogImage}
  ogImageAlt={seoData.ogImageAlt}
  canonicalUrl={seoData.canonicalUrl}
  keywords={seoData.keywords}
>
  {settings.imageDomain && (
    <link rel="preconnect" href={settings.imageDomain} slot="head" />
  )}

  <!-- Hero Section -->
  <section class="theme-hero-section py-8 lg:py-12">
    <div class="container max-w-7xl">
      <Breadcrumb items={breadcrumbs} />
      
      <div class="theme-page-header">
        <h1 class="theme-page-title">
          {categoryName}
        </h1>

        <p class="theme-page-description">
          {
            categoryDescription ||
              `Explore all articles in the ${categoryName} category. Discover insights, tips, and stories curated specifically for this topic.`
          }
        </p>
      </div>
    </div>
  </section>
  
  {posts.length > 0 ? (
    <BlogList posts={posts} />
  ) : (
    <div class="py-16">
      <div class="container">
        <div class="text-center max-w-md mx-auto">
          <div class="w-16 h-16 flex items-center justify-center mx-auto mb-4" 
               style="background: var(--bg-tertiary); border-radius: var(--radius-full)">
            <div class="w-8 h-8" style="background: var(--text-muted); border-radius: var(--radius-sm)"></div>
          </div>
          <h2 class="text-xl font-semibold mb-2" style="color: var(--text-primary)">No Articles Yet</h2>
          <p class="mb-6" style="color: var(--text-secondary)">
            The "{categoryName}" category is still being filled with content. Check back soon for fresh articles!
          </p>
          <a href="/categories" 
             class="inline-flex items-center font-medium transition-colors" 
             style="color: var(--text-accent); transition: color var(--animation-duration) var(--animation-easing)"
             onmouseover="this.style.color='var(--color-primary-dark)'"
             onmouseout="this.style.color='var(--text-accent)'">
            ‚Üê Explore Other Categories
          </a>
        </div>
      </div>
    </div>
  )}
  

</BaseLayout>