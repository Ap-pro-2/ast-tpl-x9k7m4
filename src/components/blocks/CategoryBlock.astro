---

import { getCollection, getEntry } from 'astro:content';
import ProductCard from '../ProductCard.astro';

export interface Props {
  category: string;
  limit?: number;
  title?: string;
}

const { category, limit = 6, title } = Astro.props;


const allProducts = await getCollection('affiliateProducts');
const categoryProducts = allProducts
  .filter(product => {
    
    return product.data.category.id === category;
  })
  .slice(0, limit);

if (categoryProducts.length === 0) {
  return null;
}


const categoryInfo = await getEntry('affiliateCategories', category);
const displayTitle = title || `Best ${categoryInfo?.data.name || category} Products`;
---

<section class="category-block mb-12">
  <h3 class="text-2xl font-bold mb-6 text-center" 
      style="color: var(--text-primary); font-family: var(--font-heading);">
    {displayTitle}
  </h3>
  
  <div class="products-grid space-y-8">
    {categoryProducts.map(product => (
      <ProductCard
        title={product.data.title}
        description={product.data.description}
        price={product.data.price}
        originalPrice={product.data.originalPrice}
        image={product.data.image}
        imageAlt={product.data.imageAlt}
        affiliateUrl={product.data.affiliateUrl}
        rating={product.data.rating}
        reviewCount={product.data.reviewCount}
        brand={product.data.brand}
        features={product.data.features}
        pros={product.data.pros}
        cons={product.data.cons}
        badge={product.data.badge}
        buttonText={product.data.buttonText}
      />
    ))}
  </div>
</section>